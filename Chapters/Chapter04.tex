\chapter{Experiencias realizadas (mediciones)}
En este capítulo se detallan las distintas mediciones del sistema completo asi como mediciones de modulos aislados. 
En la primera parte se detallan mediciones en el simulador numérico, para despues detallar mediciónes en las implementaciones completas realizadas, utilizando un medio óptico y luego un medio acústico.
\section{Implementación en software}
Como paso previo a realizar las implementaciones completas sobre FPGA y software, simuladores numérico de todas las etapas fueron implementados y combinados para corroborar los resultados teóricos. Esta implementación es de código abierto y realizada utilizando el lenguaje de C/C++ ya que para medir tasas de error muy pequeñas, (del orden de $10E-8$) se necesitan transmitir grandes cantidades de datos, por ejemplo para el simulador sobre medio óptico se simuló la transmisión de mas de 1 Gigabit de datos por cliente, por lo que se requiere de la mayor performance posible por parte del simulador.
\subsection{Estructura general}
Los diferentes módulos se implementaron en lenguaje C/C++ de una manera mayormente independiente del sistema operativo y se encadenan entre si mediante la entrada/salida estandard (STDIN/STDOUT). La simulación comienza con un bloque de datos aleatorio de datos binarios alimentadas a la primer etapa, o sea el modulo de corrección de errores. La salida codificada es almentada a la siguiente etapa, el scrambler. De esta manera los datos originales son transmormados en cada etapa y sucesivamente atraviesan todos los módulos, pasanto por el simulador de medio físico y entrando a la etapa decodificadora hasta llegar a la última estapa, el decodificador del corrector de errores. Esta salida final es comparada con la entrada original, y finalmente se calcula y reporta el BER.
Utilizando esta modularidad se puede configurar el simulador como un sistema secuencial de esta manera:

\small
\begin{verbatim}
 ./rsenc <${FILE} | ./scrambler ${SCRAMBLEBLOCK} >rs.out
 ./bfenc ${CLIENTES} < rs.out | ./noisesim -c ${CLIENTES} -r 16.6 >bfenc.out
 ./bfdec ${CLIENTES} <bfenc.out >bf.out
 ./descramble ${SCRAMBLEBLOCK} <bf.out | ./rsdec >rsdec.out
\end{verbatim}
\normalsize
O bien encadenar cada modulo utilizando un solo comando de esta manera:
\small
\begin{verbatim}
./rsenc <${FILE} | ./scrambler ${SCRAMBLEBLOCK} | ./bfenc ${CLIENTES} | \
                 ./noisesim -c ${CLIENTES} -r 16.6 | ./bfdec ${CLIENTES} | \ 
                 ./descramble ${SCRAMBLEBLOCK} | ./rsdec > file.out
\end{verbatim}
\normalsize

Las ventajas de la primera configuración de simulación son las de poder acceder a los archivos intermedios, utiles para depuración y mediciones por etapa, mientras que la segunda configuración tiene la ventaja de ser mas compacta y aprovechar todos los CPUs disponibles en el sistema, ya que el sistema operativo asigna un proceso a cada etapa y estas se ejecutan en paralelo.

La implementación sobre medio acústico no presenta mayor inconveniente ya que las tasas de transmisión son bajas, acotadas naturalmente por el medio y ancho de banda disponible, por lo 
que no se necesitan de mayores recursos computacionales para la simulación. Otro caso es la simulación del medio óptico, donde normalmente se necesita simular una transmisión de $1*10E9$ bits o mas para obtener una medición confiable del BER del sistema, ya que este medio tiene naturalmente una tasa elevada y un BER muy reducido. Adicionalmente, sobre este medio el sistema soporta un máximo de 128 clientes que deben ser simulados en cada corrida, por lo que los recursos computacionales requeridos son considerables. A raiz de este problema, y aprovechando que la simulación es altamente paralelizable, se implemento un modelo de cliente-servidor donde los cálculos son repartidos entre un cluster de múltiples nodos.

\subsection{Etapa de corrección de errores/Scrambler}
Estas estapas son muy sencillas de simular, ya que existen implementaciones de codigo abierto disponibles muy eficientes para reed-solomon, y el scrambler/descrambler es un algoritmo trivial muy sencillo y rápido de implementar. Se utilizó la popular libreria libFEC del autor Phil Karn [CITA], con el único agregado de hacer disponible la entrada y salida de símbolos mediante la entrada y salida estandard del sistema operativo.

\subsection{Bloom-filter}
La implementación por software del algoritmo de filtro de Bloom no tiene mayor dificultad ya que es un algoritmo muy sencillo. Todos los parametros, tanto el tamaño del filtro M como la cantidad de clientes a simular son configurables. Una característica que merece mencionarse es el sistema de minimización de peso de Hamming que esta implementado en esta etapa. La implementación se realiza mediante una tabla, lo que permite consultas en O(n)=1, aunque la tabla en si misma puede ser bastante grande escalando en memoria aproximadamente a $O(n)=2^{N}$ (TODO:Notacion de complejidad en memoria) por lo que es autogenerada en cada ejecución en función de los parámetros de simulación.

\subsection{Simulador de medio acústico}
El simulador de medio acústico es un completo modulador/demodulador que tranforma los bits de entrada en señales analógicas, a las cuales se aplican filtros pasa-bandas para simular las limitaciónes de los transductores, por ejemplo los parlantes y micrófonos de un dispositivo movil. Este módulo respeta el diseño de todos los demas, emitiendo la señal analógica como un flujo digital codificado PCM via la salida estandard del sistema. El filtro pasabanda se implementó como un filtro digital de respuesta finita o FIR, implementado en C.
La etapa de modulación fue luego reutilizada en el sistema de transmisión acústico real sin modificaciónes.

\subsection{Simulador de ruido óptico}
%% de orte.text

El bloque de simulación del canal óptico provee una estimación del BER propio de la fibra óptica del sistema. Los pasos de la simulación son los siguientes:

El tráfico RZ upstream proveniente de todas las ONUs se asume que alcanza al spliter de $128\times1$ con perfecta Sincronización de bit, o sea, sin fluctuaciones (timing jitter).
Los slots correspondientes al bit `0' contienen una pequeña intensidad óptica de CW dada por el razón de extinción de Tx.
Cada ONU on-line en el sistema agrega su propia intensidad de bit `0', incrementando la potencia base total.
Se asume que cada bit `1' agrega un pulso super-Gaussiano ($m=4$) al nivel de potencia base, con un ciclo de trabajo (duty cycle) de $1/3$.

%The physical optical channel simulation block provides an estimate of
%the BER performance of the optical channel. Simulation steps are as
%follows: RZ upstream traffic coming from all ONUs is assumed to arrive
%at the $128\times1$ splitter with perfect time synchronization, i.e., there is no timing jitter. 
%This allows to simulate merged traffic as a simple addition of optical intensities at bit slots for either `0' or `1' bits. % borrar!
%The `0'-bit slots contain a small CW optical intensity given by the Tx extinction ratio. 
%Each on-line ONU adds its `0'-bit optical intensity yielding a base power level.
% As many bit `0' optical intensities are added as on-line ONUs to produce a base power level.  
%Each `1'-bit adds a super-Gaussian ($m=4$) pulse, duty cycle $1/3$, to the base power level. %, with rising edge at slot start and peak amplitude accordingly to Tx optical mean output power.
% As many bit `1' intensities are added to base level as active Tx there are at each simulation bit slot.

Tanto el tráfico saliente como el entrante sufren atenuaciónes debidas a múltiples factores que incluyen pérdidas en el splitter, fibra y empalme (Splice). El presupuesto de potencia (Power budget) se balancea mediante un EDFA con una ganancia constante de $27$~dB. La emisión espontanea amplificada del EDFA es modelada como ruido blanco gaussiano, con una intensidad proporcional a la figura de ruido del amplificador ($7$~dB), y es agregada luego del EDFA.

%Upstream and downstream merged traffic suffers from attenuation due to
%splitter, fiber, and
%splice losses. The power budget is balanced by an EDFA with $27$~dB constant gain.
%Amplified spontaneous emission from the EDFA is modeled by white Gaussian
%noise, with intensity proportional to the amplifier noise figure ($7$~dB), and is added
%after the EDFA. 

%Real EDFAs gain increases with higher input power, i.e. amplification is not
%linear with number of active Txs. Settling for worst case scenario simulation
%we assume same $27\,dB$ gain for any number of active Txs. ASE noise produced
%at EDFA is modelled as a white Gaussian noise added to the optical signal. An
%EDFA accomplishing the amplification previously discussed ($-25.5\,dBm$ to
%$1.5\,dBm$) would have an output SNR $\geq 60\,dB$ accordingly to a estimation
%based on the bandwidth of forthcoming optical filtering at APD detector (see
%section 6.5.1 at~\cite{Agrawal:xx}). Dispersion compensation regeneration stage
%operation is accounted for by simulating no dispersion effects. Traffic is
%routed back to all ONUs by a 1x128 splitter through another $10\,km$
%fiber,
%amounting to a $27.5\,dB$ attenuation; so for one active Tx input power at each
%Rx would be $-27\,dBm$.

La señal de entrada óptica al receptor es filtrada (con un filtro Butterworth de 2do orden y $25$~GHz de ancho de banda) y fotodetectada asumiendo la respuesta de un dispositivo PD estandard (Ver seccion 4.4.3 de ~\cite{Agrawal:xx}).
Posteriormente, ruido blanco gaussiano es agregado, para representar el ruido térmico y ruido de disparo o ruido shot, y un nuevo filtro eléctrico es aplicado (en este caso es un filtro Butterworth de 2do orden y $14$~GHz de ancho de banda). [TODO: Porque?]

%The input optical signal at the receiver is filtered (2nd order low-pass Butterworth filter, $25$~GHz bandwidth) and photodetected assuming a standard PD responsivity (see section 4.4.3 of~\cite{Agrawal:xx}).
%White Gaussian noise accounting for thermal and shot noise is then added
%to the photocurrent, and 
%electrical filtering is applied (2nd order low-pass Butterworth filter, $14$~GHz bandwidth).
%Simulating the decision process a mean of samples around maximum eye opening is compared to a threshold current. 
%Current in case of `1' bits collision is higher than that of a single active Tx, so threshold is established assuming that later case.

%Real EDFAs gain increases with higher input power, i.e., amplification would not be linear with number of active Txs. 
%Settling for worst case scenario simulation we assume same $27\,dB$ gain for any number of active Txs. 
%ASE noise produced at EDFA is modeled as a white Gaussian noise that's added to the electric field. 
%An EDFA accomplishing the amplification previously discussed ($-25.5\,dBm$ to  $1.5\,dBm$) would have an output SNR $\geq 100\,dB$ accordingly to a estimation based on the bandwidth of forthcoming optical filtering at detector (see section 6.5.1 at~\cite{Agrawal:xx}). 
%Effect on traffic of dispersion compensation regeneration stage is accounted by not including in the simulation pulses deformation due to dispersion. 
%Afterwards traffic is routed back to all ONUs by a $1\times128$
%splitter through another $10\,km$ fiber, amounting to a $27.5\,dB$ attenuation arriving to each Rx with $-27\,dB$ for one active Tx.
%
%A concern was if maximum mean total input power allowed at Rx would be surpassed when multiple Tx were simultaneously active. 
%Simulation shown that the occurrence of 15 simultaneously active Tx was a very rare event {\bf <CUANTO??>}. 
%That would amount to $\sim-15\,dBm$ reaching each ONU Rx, well bellow standard commercial Rx overload of $\sim+0.5\,dBm$, that's maximum acceptable mean input power for a BER$<1\,10^{-12}$. 
%
%Rx optical bandwidth is simulated as a low pass filter (2nd order Butterworth as a digital IIR filter~\cite{IIR}, cutoff frequency $25\,GHz$). Afterwards optical traffic is converted into an electrical current. Then to account for thermal and shot noise at a typical APD white Gaussian noise current is added, with an estimated SNR $\simeq 42\,dB$ (see section 4.4.3 at~\cite{Agrawal:xx}). Then electrical filtering is applied (2nd order Butterworth IIR filter, cutoff frequency $6\,GHz$). Detection procedure is performed by comparison to a fixed current threshold. A previous simulation run with the same number of ONUs but with a single active Tx allows to determine the decision threshold at the time of maximum eye diagram opening. Addition of bit `1' amplitudes (collision) produce a current even higher than for a single active Tx, thus this bit slot will be classified as `1' at optical channel simulation output. 
%Media block account for fiber, EDFA and splitters. It attenuates optical trains (splitters and fiber attenuation minus EDFA gain) and also adds white Gaussian noise to the electric field accounting for ASE noise at EDFA. 
% MUCHO, MUY IMPORTANTE: REVISAR CALCULO OSNR (Fn) y verificar que se determina en detector %[VAB]
% ITU recommendation G. 959.1 states that certain interfaces' should operate normally up to $12\,dBm$ mean total input power. In any case if such power is surpassed it would only cause a very short time blinding of Rx affecting a so small amount of bits that wouldn't affect the logical layer ability to correct them.
% receiver overload: max input power for BER<1E-12
%Receiver block simulates Rx behavior. It's optical bandwidth is taken into account by simulating a low pass filtering of incoming traffic (2nd order Butterworth as a digital IIR filter~\cite{IIR}, cutoff frequency $25\,GHz$). Then optical traffic is converted into an electrical current. White Gaussian noise current is added to account for thermal noise at Rx, being it's SNR $\simeq 42\,dB$ accounting for thermal and shot noise at a typical APD detector (see section 4.4.3 at~\cite{Agrawal:xx}). Afterwards another filter simulates detector's linear channel (2nd order Butterworth IIR filter, cutoff frequency $6\,GHz$). Detection procedure is performed by comparison to a fixed current threshold. A previous simulation run with same number of ONUs but with a single active Tx allows to determine the decision threshold at the time of maximum eye diagram opening. Addition of bit `1' amplitudes (collision) produce a current even higher than for a single active Tx, thus this bit slot will be classified as `1' at 
optical channel simulation output. 


\section{Redes ópticas}
La implementación del sistema sobre redes ópticas fue el objetivo principal de la investigación, y solo luego de obtener resultados en este medio se pasó al medio acústico.
La simulación tuvo un papel muy importante en el desarrollo y pruebas del algoritmo en este medio, ya que las elevadas velocidades de transmisión mínimas del tranceptor óptico hace practicamente imposible mediciones directas mas alla de la extracción de valores simples como el ancho de bit y el radio de extinción.
\subsection{Simulaciónes numéricas}

Las fluctuaciones a niveles de potencia cercanos al límite de sensibilidad del dispositivo PD tienen un importante efecto en la detección de la señal.
El ruido de shot es particularmente preocupante ya que es proporcional al la fotocorriente media. En nuestra propuesta, este ruido es mas alto que en PONs comunes ya que la intensidad del bit `0' de todas las ONUs presentes contribuyen al mismo.
La intensidad resultante de la potencia de base óptica es por lo tanto altamente dependiente del razón de extinción de Tx.
En la Fig.~\ref{sim:optical} se muestra el nivel de razón de extinción mínimo requerido para lograr un BER arbitrario en la capa física como una función del número de ONUs presentes on-line.
%Noise fluctuations at power levels near the PD sensitivity limit have an important effect on signal detection. 
%Detection being made at power levels near PD sensitivity is highly sensitive to changes in noise.
%Shot noise is of particular concern as it is proportional to the mean photocurrent.
%In our network proposal the later is higher than in PONs as bit
%`0' optical intensities from all ONUs are added.
%The resulting base-level optical intensity is then heavily dependent on the Tx extinction ratio.
%Fig.~\ref{sim:optical} shows minimal extinction ratios required to
%achieve an arbitrary BER in the physical layer as a function of the
%number of on-line ONUs.
\begin{figure}[!t]
    \centering
      \includegraphics[angle= 270, width=3.5 in]{orte03.pdf}
%      \caption{Physical layer simulation result: Minimal extinction ratio required to assure a given BER}
      \caption{Resultado de simulaciones de la capa física: Nivel de razón de extinción mínimo requerido para asegurar un cierto BER}
      \label{sim:optical}
\end{figure}
En el escenario de $128$ ONUs presentes, un BER de $<10^{-3}$ puede ser logrado utilizando transmisores del tipo comercial con un razón de extinción de $\simeq16.6$~dB.
Este BER es lo suficientemente bajo para permitir rutinas de corrección de errores al nivel del canal lógico, que garanticen la transmisión libre de errores realizando una utilización acotada de la capacidad total del canal.
%In the $128$ ONUs scenario a  BER$<10^{-3}$ can be achieved using
%commercially available transmitters with an extinction ratio $\simeq16.6$~dB.
%This BER is low enough to allow for logical-channel error-correction routines that guarantee error-free transmission, while still making use of a fair fraction of channel capacity.
% perform correctly and still use a fair fraction of channel capacity.
% Fig.~\ref{sim:optical} shows simulation results for the BER vs OSNR
% for different numbers of ONUs with fixed electrical SNR $\simeq 42$~dB.
% Higher BERs as ONUs number increases due to the higher probability of
% simultaneous bit `1' transmissions (collisions) yielding pulses of
% optical power higher than that of a logical
% `1', generating intersymbol interference. Higher powers generate higher
% currents at Rxs that demand longer times to settle to logical `0' levels after
% filtering. Nevertheless, as
% can be seen in fig.~\ref{sim:optical}, in the worst case scenario (128
% ONUs) the expected OSNR at the EDFA output is enough ($\geq 40$~dB) to
% ensure a BER$<10^{-7}$. In this case simulation shown that the occurrence of
% 15 simultaneously active Tx was a very rare event, so optical power at Rx
% would be $\simeq -15$~dBm, well bellow standard commercial Rx overload
% of $\sim0.5$~dBm (maximum acceptable mean input power for a
% BER$<10^{-12}$).

\begin{figure}[t]
  \centering
  \includegraphics[width=4in]{graphs/BER-tesis.pdf} 
  \caption{BER del canal de 10 Gbps vs la cantidad de ONUs activos.}
  \label{sim:access}
\end{figure}


La Fig.~\ref{sim:access} muestra los resultados de la simulación del canal, comparando el BER medido en un solo canal, con respecto la número total de ONUs on-line. Se observan tres mediciones, las dos primeras comparando la diferencia en performance al utiliza símbolos de 8 bits contra símbolos de 16 bits, y la tercera para apreciar la diferencia en el resultado al agregar el ruido óptico dentro de la simulación.
Los resultados fueron obtenidos enviando un gigabit de datos por cada ONU simultáneamente. El mismo método se utilizó para realizar las simulaciónes reflejadas en la Fig.~\ref{BERvsExpansion}, pero en ese caso modificando los parámetros para apreciar la mejora al utilizar el algoritmo de reducción de peso de Hamming.
Puede apreciarse que cuando la cantidad de ONUs supera los 128, el BER se eleva marcádamente.
De la misma figura podemos observar una penalización de $8$ ONUs cuando el ruido de la capa óptica es tomado en cuenta (Mayormente la razón de extinción y el ruido producido por el EDFA y los PDs).
Considerando que el sistema fue diseñado para soportar comunicaciones asincrónicas (Ej. Ethernet), no es probable que en el uso normal todas las ONUs transmitan simultáneamente; por lo tanto este sistema tiene un BER de $<10^{-8}$ para cada canal cuando 119 ONUs estan transmitiendo al mismo tiempo lo que supone una carga máxima del $90\%$ ($119/128>0.9$). 


%Fig.~\ref{sim:access} shows simulation results for the fraction of the total
%capacity and the BER of one channel at the coding level (circles) and 
%including physical layer impairments (squares). 

%These results were obtained by
%sending one Gigabit of data for each ONU simultaneously.
%This figure shows a channel utilization of $15.7\%$ when all of $128$ ONUs
%are transmitting simultaneously, with a BER$<10^{-8}$. 
%From Fig. \ref{arch:fig1} we observe a penalty of $8$ ONUs when
%impairments from the optical layer (mainly extinction ratio and noise from EDFA and PDs) are taken into account.
%Considering that the system was designed to support asynchronous communications (e.g., Ethernet), it is not likely that all the ONUs will transmit simultaneously (e.g., Internet links often operate at most at $90\%$ load); and therefore our system has a BER $<10^{-8}$ for each channel when 119 ONUs are transmitting at a same time ($119/128>0.9$).
%, removing only one ONU re-establish the desired BER. 
%
%It is worth to remark that, even if the optical channel can induce a
%significant number of errors, the access layer has shown to be able to correct a
%very large number of errors (it is based on
%LDPC+Reed-Solomon+Bloom-Filters), as can be seen on the curve with squares
%at fig.~\ref{sim:access}.
%Observe that the high error rates correspond to a
%worst-case scenario when all ONUs are transmitting simultaneously at
%full capacity, and also 
%there is a low penalty due to physical layer impairments.
%Figure~\ref{sim:optical} presents the simulation's BER vs optical OSNR
%for different numbers of ONUs. %[VAB]
%As the number of ONUs increases higher BERs are obtained at the same optical SNR (electrical SNR is fixed at $\simeq 42\,dB$). In particular there is a penalty of about $30\;dB$ for 128 ONUs in comparison to 1 ONU. This is expected as a consequence of the higher probability of simultaneous bit `1' transmissions (collisions) yielding pulses (logical `1's) of different powers (sum of the power of each transmitter). Higher powers demand more time to settle post filtering current to logical `0' levels. If the following bit slot is indeed a logical `0' an erroneous determination is more possible with a higher collision probability. Nevertheless it can be inferred from simulation results that optical channel should not add significantly to the BER for the whole link as the estimated optical SNR of $\geq 100\,dB$ even for the worst case scenario with 128 ONUs present.
% \begin{figure}[!t]
%     \center
% %     \subfigure[Optical channel]{
% %      \label{sim:optical}
%       \includegraphics[scale=0.4]{BERvsSNR_6GHz.pdf}
% %    }
% %    \subfigure[Logical channel]{
% %      \label{sim:access}
%       \includegraphics[scale=0.4]{BERvsONUs.pdf}
% %    }
%     \caption{Simulation results}
%       \label{archfig}
% \end{figure}

\section{Implementación en FPGA}
El estudio de PONs plantea el desafío de generar, transmitir y recibir
señales de 10 Gbps en el laboratorio. El costo de estos sistemas
suele ser muy elevado. En este trabajo proponemos una alternativa de muy
bajo costo basada en la generación y trasmisión de señales en FPGAs.

\subsection{Arquitectura alto-nivel de la FPGA Xilinx ML507}
El equipamiento consta de un kit de desarrollo ML-507 de Xilinx y un
transceptor SFP+ con varios emisores Láser XFP de 1330 nm y 1550 nm, con capacidad de hasta 10 Gbps
en modulación NRZ y alcance de 10km en fibra monomodo. Para realizar
las mediciones presentadas en este trabajo se utilizaron dos dispositivos:
\begin{itemize}
 \item {\em Integrated Bit Error Rate Tester} (iBERT) \cite{4gtxs}: Es
un medidor de tasa de error que utiliza un analizador lógico embebido dentro
del mismo diseño de la FPGA, con interfaz para la herramienta de
verificación y depuración ChipScope. Mediante este agregado, que debe
ser sintetizado dentro del diseño, es posible medir en tiempo real
varios parámetros del transceptor asi como realizar estadísticas y
mediciones de error, variando tasas y características de la transmisión
en tiempo real.
 \item Osciloscopio Óptico Agilent 86100A con módulo óptico 86105A: Para
realizar las mediciones físicas contamos con este equipo que posee un
ancho de banda de 20 Ghz en potencia óptica, suficiente para capturar en
tiempo real los bits individuales o realizar un diagrama de ojo.
\end{itemize}
\subsection{Transmisión a multi-gigabit}
La plataforma de FPGA de Xilinx no fue seleccionada solamente porque la lógica programable es necesaria para la transmisión a altas velocidades, sino por la cuestión práctica de que los vendedores de FPGAs suelen incluir tranceptores de multi-gigabit en las mismas, esto es, la ``maquinaria'' necesaria para serializar/des-serializar y codificar bits de datos, asi como las interfaces para conectar las salidas directamente a las entradas de tranceptores ópticos como uno o mas XFPs [CITA].
Es normal que los tranceptores de multi-gigabit puedan ser utilizados con otros medios, por ejemplo sobre cables trenzados de cobre o lineas de transmisión de alta velocidad sobre PCBs. Serial-ATA y PCI-Express son buses de transmisión de datos que suelen ser implementados utilizando los tranceptores de la FPGA. Estos medios de transmisión eléctricos no fueron considerados debido a las distancias muy limitadas entre los nodos, por lo que la implementación de alta velocidad con la FPGA fue puramente sobre fibras ópticas.

\subsection{Diseño del sistema propuesto}
En la Fig.~\ref{fig:fpgadesign} puede observarse el diseño propuesto en el cual se implementó y probó exitosamente el algoritmo transmitiendo a tasas de 5 Gigabits mediante una fibra óptica.
El echo que el algoritmo pueda transmitir a altas velocidades se da gracias a ciertas características del diseño que seran descritas a continuación.

A nivel de diseño digital, el sistema puede verse como 4 módulos separados:

\begin{description}
 \item[tranceptor de gigabit:] esto es un hardware provisto por la FPGA que puede verse como un serializador/deserializador pero contiene mas de 15 subsistemas incluyendo buffers, PLLs, codificadores y decodificadores. Asi mismo el tranceptor posee herramientas para sincronización y debugging, permitiendo realizar mediciones y crear loopbacks en 3 puntos diferentes del flujo de datos para detectar anomalias. Se conecta a la lógica programable de la FPGA por medio de mas de 200 señales de control y transferencia de datos, cuyas funciones son encapsuladas por un modulo especial de lógica que simplifica la interfaz con el resto del sistema. Esta lógica de interfaz se implementó como un módulo de verilog, llamado ``v5\_gtxwizard\_v1\_7\_tile.v''. Debido a la alta cantidad de opciones y señales disponibles, asi también como las distintas configuraciónes posibles, este módulo fue generado a partir de una plantilla, que es generada a su vez con una herramienta provista por Xilinx.

 \item[Generador de frame:] Este módulo se encarga de codificar los datos a transmitir y enviarlos por el transceptor de gigabit. Contiene implementaciones de todos los módulos necesarios, como el codificador de RC4, Bloomfilter encriptado y expansion de peso de Hamming, asi también como del sistema de sincronización de frame. La estructura interna es la de una máquina de estados finita, por lo que no requiere de CPU ni de software, estando implementada integramente en logica digital. Se implementó en un solo modulo de verilog llamado ``frame\_gen.v''. Exporta múltiples señales de control y depuración al módulo de control.
 
 \item[Decodificador de frame:] La contrapartida del generador del frame es el decodificador, que posee los decodificadores correspondientes tales como Reed-Solomon, RC4, bloomfilter y expansion de peso de Hamming, asi también como el sincronizador de frame y word, que utiliza parcialmente el hardware de sincronización del tranceptor de gigabit para sincronizar a nivel de byte, sumado a una sincronización propia para lograr la sincronización a nivel de double-word y finalmente, sincronización de frame. La implementación tambien consiste de una sola maquina de estados finitos sin CPU o software de ningún tipo.Se implementó en un solo modulo de verilog llamado ``frame\_dec.v''. Adicionalmente un contador de BER se implementó en esta fase, dado que los datos enviados son un patrón de prueba y es posible medir la tasa de errores de manera simple. Las estadísticas de errores son exportadas mediante señales conectadas al módulo de control.
 
 \item[Módulo de control:] Este módulo cumple la función de interfaz entre el sistema y el usuario, permitiendo modificar y estudiar parámetros de manera sencilla, asi también como presentar las estadísticas de una manera rápida. Utiliza una interfaz serial del tipo RS232 mediante la que el operador puede realizar acciones y leer valores del sistema. Para su implementación se utilizo un CPU del tipo Xilinx Microblaze ***TODO: CITA***, y un programa en lenguaje C encargado de imprimir los menúes de control y enviar y recibir datos hacia los módulos generadores y decodificadores de frame. Las operaciones se realizan de manera asincrónica por lo que la velocidad del CPU puede ser mínima. Es necesaria cierto ``glue logic'' o lógica de pegamento entre las señales que exportan los demás módulos y el bus de tipo FSL que utiliza el CPU Microblaze. Esto se implementa en el módulo ``copro1.v'' que tambien es el módulo principal del diseño, interconectando correctamente las señales de todos los módulos.
\end{description}

El sistema utiliza buffers tanto de lectura como de escritura al tranceptor, por lo que puede operar a velocidades mucho menores que este. Por ejemplo, si el tranceptor de gigabit posee un ancho máximo de bus TXDATAWIDTH y la velocidad de transferencia es TXCLOCK, la velocidad de reloj DATACLOCK necesaria para mantener los buffers internos del tranceptor llenos es simplemente $DATACLOCK=TXCLOCK/TXDATAWIDTH$, por lo que transmitiendo a 5 Gigabits por segundo utilizando el máximo TXDATAWIDTH de 32 bits, tenemos que $DATACLOCK=156Mhz$ un valor alcanzable para la FPGA utilizada y fácilmente implementable en un ASIC.
La velocidad de las implementaciones de generador CSPRNG RC4 y el codificador/decodificador de Reed-Solomon son críticas para la performance del sistema ya que el resto de las etapas no introducen mayores retrasos. Para el algoritmo Reed-Solomon se utilizo un IP de la biblioteca de Xilinx que tiene una performance óptima, mientras que el algoritmo ARC4 fue implementado en verilog poniendo especial énfasis en la performance, logrando un flujo de 1-byte de stream pseudoaleatorio por cada ciclo de reloj.

\begin{figure}[t]
  \centering
    \includegraphics[width=6in]{graphs/fpgadesign.pdf}
\caption {Diseño de alto nivel sobre FPGA}
\label{fig:fpgadesign}
\end{figure}

% de confEUA.tex

\subsection{Transmisión a 9 Gbps con SFP+}
El montaje para la experiencia se realizó conectando el transceptor SFP+
al conector correspondiente en la placa de desarrollo ML-507 y un bucle de
fibra óptica ({\em loopback}), con el objetivo de realizar las
mediciones de BER. Luego, para realizar las mediciones con el
osciloscopio, se debe conectar el extremo de recepción de la fibra
óptica al osciloscopio. En este caso generamos el disparo del
osciloscopio mediante la señal de reloj del sistema (placa ML-507) que
se obtiene a través de los conectores SMA J12 y J13 (si bien es
diferencial sólo utilizamos uno de ellos).  Para la depuración y
configuración se utilizó la interfaz JTAG USB de Xilinx ``Platform Cable
USB II''.
\subsection{Configuración del reloj del transceptor}

La tasa de transmisión del transceptor GTX está dada por la
frecuencia de reloj de entrada $F_{PLL\_Clock}$, donde se transmite un
bit por cada semiciclo (la modulación es NRZ); entonces la tasa de
transmisión será
$R_{line}\mbox{[bps]}=F_{PLL\_Clock}\mbox{[1/s]} \times 2$.  La
frecuencia del reloj de entrada del PLL está gobernada por la ecuación
5-1 \cite[Pag. 88]{ug198}, que reproducimos a continuación:

\begin{equation}
F_{PLL\_Clock} = F_{CLKIN} \times \frac{PLL\_DIVSEL\_FB \times
DIV}{PLL\_DIVSEL\_REF}% \enspace
\end{equation}\\

donde las constantes $PLL\_DIVSEL\_REF = \{1;2\}$, $DIV = \{4;5\} $ y
$PLL\_DIVSEL\_FB = \{1;2;3;4;5\}$ son configurables por software;
mientras que la frecuencia base se configura con las llaves
SW6~\cite[Tabla 1-32]{ug347}: $
F_{CLKIN} (Mhz)= \{62.5;75;77.76;100;125;150;156.25;311.04;622.08\}$.


 Modificando los parámetros puede lograrse, en teoría, un amplio rango
de la frecuencias $F_{PLL\_Clock}$, pero de acuerdo a la documentación
del PLL \cite[Pág. 71]{ug366}~\footnote{La velocidad máxima no se
detalla en la documentación del GTX de Virtex5, pero si en la
documentación del Virtex6, que excepto en el modelo HTX posee parámetros
similares.}, este tiene un rango de operación nominal desde $1.2$ a
$2.7$ Ghz en FPGAs de grado $-1$ tal como el que se encuentra en la
placa de desarrollo ML-507. Sin embargo en este artículo documentamos la
obtención y medición de velocidades de oscilación estables para el PLL
de hasta $4.5$ Ghz (lo que implica una tasa de transmisión de $9$ Gbps),
fuera del rango de operación especificado por el fabricante.

\begin{figure}[t]
  \centering
    %\includegraphics[scale=0.70]{plot.png}
    \includegraphics[width=3.5in,angle=270]{medicionesPaper/BER_sp_gray.pdf}
\caption {BER vs. punto de muestreo.}
\label{fig:BERvsSamplingPoint}
\end{figure}

\subsection{características del tranceptor de gigabit a altas velocidades}


\begin{figure}[!t]
   \centering
   \subfloat[Señal óptica a $4.5$ Gbps]{{\includegraphics[width=0.45 \textwidth]{medicionesPaper/screen3.png} }}%
   \qquad
   \subfloat[Señal óptica a $6$ Gbps]{{\includegraphics[width=0.45 \textwidth]{medicionesPaper/screen4.png} }}%
   \qquad
   \subfloat[Señal óptica a $7.5$ Gbps]{{\includegraphics[width=0.45 \textwidth]{medicionesPaper/screen5.png} }}%
   \qquad
   \subfloat[Señal óptica a $9.33$ Gbps]{{\includegraphics[width=0.45 \textwidth]{medicionesPaper/screen6.png} }}%
   \qquad
   \subfloat[Señal óptica a $12.44$ Gbps]{{\includegraphics[width=0.45 \textwidth]{medicionesPaper/screen7.png} }}%
   \qquad
   \subfloat[Señal óptica a $12.44$ Gbps, transmisión 10110101010]{{\includegraphics[width=0.45 \textwidth]{medicionesPaper/screen12.png} }}%
  \caption {Capturas de pantalla de la medición de la señal óptica a la salida del XFP variando la tasa de transmisión de $4.5$ a $12.44$ Gbps}
  \label{fig:ImgTasa}
\end{figure}





Las Fig.~\ref{fig:ImgTasa} muestran la evolución de la señal óptica producida a diferentes
tasas. Nótese que aunque el equipo puede generar señales estables de
hasta $12.44$ Gbps pero no puede recibirlas a esa frecuencia, por lo que las
mediciones de BER se realizaron solo hasta $9.33$ Gbps. Todas las señales
corresponden a la secuencia 10101010, excepto la última figura,
que fue generada con una secuencia distinta para demostrar el total
control sobre la señal generada. El transceptor posee la capacidad de
realizar una codificación 8B/10B adicional, pero para estas mediciones
ese módulo fue desactivado.
El punto de muestreo de la señal es importante, ya que si se elige correctamente se minimizará el BER, tal como lo muestra la Fig.~\ref{fig:BERvsSamplingPoint}, donde se aprecia como el BER es minimizado si el punto de muestreo cae exactamente en la mitad del bit. Tambien en la misma figura puede compararse distintas tasas de transmisión y ver que las curvas de BER causadas por el punto de muestreo son difierentes para cada tasa. Esto es porque como puede verse en las Figs.~\ref{fig:ImgTasa}, a tasas elevadas el pulso del bit se deforma y el punto de sampleo óptimo se modifica, acompañando esta deformación del bit transmitido.


\subsection{Problema de linea desbalanceada y codificación 8B/10B}
La conexión eléctrica de la FPGA al Láser XFP debe soportar señales de 4 Gigahertz o mas, y puede verse como un canal con características de un filtro pasa-altas. Esto requiere que la señal este balanceada eléctricamente, por lo que deben codificaciónes de balanceo para una correcta transmisión. Dichos algoritmos pueden ser el conocido 8B/10B u otras codificaciones, aunque 8B/10B tiene soporte de codificación/decodificación por hardware en el tranceptor de gigabit de Xilinx.

El hardware de prototipado no permite implementar el algoritmo diseñado sin modificaciones. En la Fig.~\ref{fig:expansionbit} se aprecia una expansión progresiva a medida que el desbalanceo de la señal se hace mas pronunciado. Los efectos de la expansión del tamaño de bit son evidentes en la fig.~\ref{fig:ImgExpansion} donde las gráficas de potencia óptica ponen en evidencia la expansión e interferencia causada por una señal desbalanceada.
Efectivamente el receptor recibe hasta 3 ``unos'' por cada ``uno'' transmitido de manera desbalanceada, generando una interferencia que impide el funcionamiento del sistema.

\begin{figure}[t]
  \centering
    \includegraphics[width=4in]{graphs/expansionbit.pdf}
\caption {Se detalla la expansión del tiempo de bit en una señal desbalanceada a medida que la cantidad de unos por frame va disminuyendo. El tamaño de frame es de 512 bits, por lo que el mínimo de tamaño de bit esta con 256 unos por frame con una señal perfectamente balanceada. La tasa nominal es de 2.5Gbps}
\label{fig:expansionbit}
\end{figure}

\begin{figure}[!t]
   \centering
   \subfloat[Señal con 256 unos por frame (8B/10B), 400ps por bit]{{\includegraphics[width=0.45 \textwidth]{graphs/expansion1.jpg} }}%
   \qquad
   \subfloat[Señal con 48 unos por frame, 1100ps por bit]{{\includegraphics[width=0.45 \textwidth]{graphs/expansion2.jpg} }}%
   \qquad
  \caption {Señal de potencia óptica de un Láser XFP Sumitomo de 1330nm. Se observa una expansión de bit cuando se reduce la cantidad de unos por frame, desbalanceando la señal. La tasa nominal utilizada es de 2.5 Gbps}
  \label{fig:ImgExpansion}
\end{figure}

Este desbalanceo se soluciona simplemente aplicando las codificaciónes de balanceo a los datos antes de transmitirlos. Sin embargo, esta transformación es incompatible con el filtro de bloom, ya que la interferencia de dos señales basta para eliminar la codificación y desbalancear nuevamente la señal. La solución definitiva es utilizar un hardware donde la señal no necesite balancearse, pero mientras tanto se opto por la siguiente solución para poder utilizar la placa ML507 y poder realizar mediciones sobre el protocolo: Al realizar las experiencias, uno de los clientes transmite su señal pseudoaleatoria super-impuesta con una señal 8b/10b, por lo que la señal esta balanceada y es transmitida y recibida correctamente. Son los demas clientes los que transmiten una señal desbalanceada con muy pocos unos, causando solamente interferencias. La señal de estos clientes no puede recuperarse pero las mediciones son solamente realizadas sobre el cliente que esta balanceado, por lo que el sistema puede funcionar a la máxima tasa soportada por la FPGA (hasta 5Gbps) mientras que solo uno de los clientes pueda comunicarse y los demas actuen efectivamente solo como ruido.

\subsection{Sincronización a nivel de bit, word y frame}

\begin{figure}[t]
  \centering
    \includegraphics[width=6in]{graphs/optsync.pdf}
\caption {Flujo de datos en la sincronización óptica. El primer bloque, sincronización de bit alinea a un límite de byte, lo que resulta en cuatro posibles alineaciones distintas. El frame es luego es alineado a 32 bytes mediante desplazamientos o shifts.}
\label{fig:optsync}
\end{figure}


La sincronización no se trató detenidamente en la sección teórica de esta tesis ya que desde un principio se consideró como un tema ajeno a la misma. Sin embargo, para la implementación real es imprescindible obtener la sincronización entre los nodos que deseen utilizar un canal. Esto no es una tarea sencila considerando que debe hacerse sobre un canal que contiene elevadas tasas de ruido.

La estrategia utilizada para la transmisión por medio óptico es utilizar el hardware de sincronización que posee el tranceptor de multi-gigabit ya incluido en la FPGA. Este módulo [TODO: Cita] es bastante flexible y se basa en la utilización de un prefijo o ``comma'', que es una serie de bits determinada que se transmite antes de iniciar la comunicación. Esta serie de bits es configurable pero es deseable que posea ciertas características como una alta autocorrelación, para optimizar su detección en el stream de datos recibidos.
La sincronización se realiza en dos fases:
\begin{enumerate}
 \item El iniciante envía el prefijo de sincronización y este es detectado por el módulo de alineación del receptor. Este módulo alinea a nivel de bit y byte, o sea que garantiza que en el buffer de salida de 32 bits, el prefijo aparece en el bit 0, 8, 16 o 24 (Ver fig.\ref{fig:optsync}).
 \item Una vez alineado el prefijo en el buffer de salida, solo resta detectar en qué posicion ha quedado y comenzar a leer el frame desde la posición siguiente. Esto se realiza en el código verilog sintetizando cuatro detectores que simultaneamente testearan por cada posición y deciden en un solo reloj cual es la alineación correcta. Al ser solo 4 posiciónes posibles, es una solución eficiente.
\end{enumerate}

En teoría, solo debería realizarse la sincronización al principio de las comunicaciónes. En la práctica los relojes no son perfectos y es necesario sincronizar periódicamente. En la implementación óptica se envía el prefijo de sincronización al comienzo de cada frame.
Para evitar colisiones, el hardware de alineamiento se desactiva al detectarse una buena sincronización y se reactiva al finalizar la recepción del frame. Esta es una operación extremadamente rápida, recordemos que a una velocidad de 5Gbps, cada frame de 1024 bits tiene una duración temporal de 200 nanosegundos.

\section{Redes acústicas}
Debido en parte a la dificultad de implementación y debugging sobre la logica de la FPGA, y la imposibilidad de realizar mediciones a muy altas velocidades, se propuso la implementación sobre un medio acústico como solución intermedia. Las señales acústicas se interfieren típicamente de manera aditiva y un modem acústico debe representarse como un canal binario simétrico en lugar de un canal-Z. Pero si utilizamos ciertas modulaciones, tales como OOK (on-off Keying) de manera que la frecuencia portadora sea varias veces mayor al ancho de bit, la interferencia entre bits tendra siempre un efecto aditivo, mientras que los ceros no causan interferencia. Esto forma un canal-Z mediante el cual puede implementarse el sistema de comunicación segura descripto en esta tesis. Debido a las características de modulación necesarias, las velocidades de transmisión son muy bajas, ya que ancho de banda de un parlante o micrófono es relativamente reducido (de 2 a 15 khz) y la modulación OOK tiene una baja densidad espectral. 
No obstante es un excelente medio para realizar pruebas ya que pueden ser implementadas totalmente via software, y puede ser utilizado en todas las aplicaciones que no requieren elevadas tasas de transmisión.

\subsection{Modulación}
% de newJIS_140512
El medio de transmisión sónico utiliza ondas de presión en lugar de electromagnética pero las técnicas de modulación que pueden utilizarse son las mismas.
Sin embargo, no todas las modulaciones siguen el comportamiento de canal Z descrito en la Seccion [TODO].
La modulación On-Off Keying (Un caso especial de modulación ASK, Amplitude Shift Keying), es uno de los tipos de modulación que permite implementar un canal Z sobre un medio acústico si se utiliza sobre cierto rango de parámetros. Utilizando transductores (micrófonos y parlantes) comerciales del tipo presentes en la mayoría de los dispositivos móviles probados, la frecuencia de portadora puede variar de 10 Khz a 16 Khz. Se obtienen resultados buenos con una tasa de transmisión de 1000 bps al nivel de frame. En los experimentos que se detallaran en las secciones siguientes, el retraso (delay) o tiempo que le lleva a un bit atravesar la red, fue extremadamente alto debido a una combinación de baja velocidad de transmisión y la necesidad de un buffer muy grande (1024 bits) necesario para la utilización del esquema de corrección de errores seleccionado (Reed-Solomon 223/255). Si bien aumentar la velocidad de transmisión no es sencillo, modificar el algoritmo de corrección de errores o sus parámetros (Por ejemplo, utilizar algún esquema tipo BCH [12]) podria reducir el delay de datos drásticamente.

Como tecnica de ``pulse-shaping'' se utiliza un simple filtro FIR pasa-banda a la salida de la etapa de modulación, así como también en la entrada de la etapa de demodulación. Este filtro además de reducir el ancho de banda utilizado, ayuda a rechazar interferencias.
Adicionalmente un duty-cycle de 50\% demostró ser el óptimo para la modulación.
%On-Off Keying modulation of sound waves, following the Z-channel interface model described in Section 2.2., encode the transmitted bits as pulses. Carrier frequency can vary from 10 kHz to 16 kHz. Good results can be obtained with a rate of 1000 bps at frame level. In experiments, delay (the time for a bit to traverse the network) was very high, due to Reed-Solomon 223/255 coding, a frame to support up to 16 users and the low capacity of the physical media. A more sensible choice of FEC algorithm (like BCH [12]) could drastically reduce data delay. 

%Simple pulse shaping is realized using a pass-band filter at the output of the modulation and also at the input of the demodulator. This filter also helps reject unwanted interference.
\subsection{Sincronización}
% de newJIS_140512

\begin{figure}[t]
  \centering
    \includegraphics[width=4in]{graphs/acusync.pdf}
\caption {Sincronización acústica. En la figura a) se recorren serialmente todas las posibilidades hasta encontrar la mayor potencia de bit, que corresponde a la mejor sincronización. Luego, en la figura b) se calcula el umbral de decisión.}
\label{fig:acusync}
\end{figure}

Como se desprende de la descripción del canal de comunicaciones, la sincronización entre el transmisor y el receptor es esencial para la correcta decodificación de la información. 
En el caso del medio óptico la sincronización de bit y word debe realizarse a tasas tan elevadas que requiere necesariamente soporte de hardware por parte del transceptor.
Sin embargo a las reducidas tasas (1000 bps) utilizadas en el canal acústico permiten realizar una sincronización por software sin ningún soporte de hardware adicional. 
El método es muy similar al utilizado en el canal óptico: Un patrón inicial de sincronización es enviado, para que el receptor pueda realizar un ajuste de parámetros tales como fase y umbral de decisión (Ver Fig.~\ref{fig:acusync}). La deriva y fluctuación del reloj del sistema (drift y jitter) no son significantes a esta baja velocidad de transmisión por lo que no se requiere corrección de ningun tipo, haciendo que la Implementación del modem por software sea muy sencilla.
Ciertos parámetros si bien son inicializados en la etapa de sincronización, son por naturaleza dinámicos y se ajustan periódicamente, como por ejemplo el umbral de decisión, que es recalculado a partir de un promedio de los datos de entrada. La fase es también corregida utilizando los datos de entrada como referencia. Notar que este método de sincronización simple permite detectar el comienzo de frame a su vez que se alinea a nivel de bit; ambas alineaciones son necesarias en cada comunicación (pero la alineación de frame solamente entre los ONUs comunicantes). Adicionalmente, una vez comenzada la transmisión, los datos seran indecifrables gracias al algoritmo de time-hopping guiado por un CS-PRNG.

%As it follows from the description of the communication channel, synchronization between the transmitter and receiver is essential for the correct decoding of information. For this purpose, an initial synchronization pattern is sent, so the receiver can adjust parameters like phase and decision level (see Figure 3). For the data bits transmission a duty cycle of 50\% showed in our experiments an enhanced detection. Clock drift and jitter are not significant at this low transmission speed and so no correction is required, making the software modem implementation very simple. Decision level is dynamic, meaning it is constantly re-calculated from averaged input data. The receiver symbol phase is also corrected using the input data as reference. Notice that this simple synchronization method allows detecting the frame start as well as the bit slot; both are needed at every communication. Moreover, once the data began to be transmitted, the communication becomes indecipherable thanks to the CS-PRNG.


\subsection{Medición multi-usuario}

Todas las mediciones fueron realizadas a una tasa de 1000 bps, utilizando una señal portadora acústica de 16 kHz, que se encuentra en el límite auditivo de la mayoría de los adultos de mas de 30 años[CITA] aunque tambien es posible que ciertos parlantes tengan problemas a esta frecuencia, en cuyo caso puede reducirse y utilizar una portadora de 12 kHz.
La cantidad total de datos transmitidos por canal fue de 4096 bits en cada medición. El volumen de la señal fue seteada al máximo para cada dispositivo, mientras que la amplificación de entrada de la señal obtenida por el micrófono fue optimizada en cada caso para obtener el menor BER.
Con el modulador y sincronizador implementado, el sistema opera con tasas de error aceptables con una separación máxima entre nodos de 1 metro, una distacia que normalmente excede la existente entre un terminal móbil (Celular, etc.) y una computadora fija en el mismo escritorio (Ver Fig.~\ref{acudist}). Aún para un alto número de clientes simultaneos (>10) el sistema no presenta altas tasas de error o ancho de banda reducido, como puede verse en la Fig.~\ref{acumult}.
En las pruebas con el software actual, el retraso del canal es de mas de 60 segundos, excesivo para muchas aplicaciones que no necesitan alto ancho de banda pero requieren un corto tiempo de respuesta (por ejemplo, aplicaciones bancarias). El retraso puede ser disminuido de dos maneras: 
\begin{enumerate}
 \item Decrementando la cantidad máxima de clientes simultaneos soportados por el sistema.
 \item Utilizando algoritmos de ECC de bajo retraso, tales como BCH, ya que actualmente el retraso esta causado por el algoritmo de Reed-Solomon que requiere llenar un buffer de 256 bytes (2048 bits) antes de poder comenzar la decodificación.
\end{enumerate}

\begin{figure}[t]
  \centering
    \includegraphics[width=4in]{graphs/medidas_clientes_JIS-fig6.pdf}
\caption {Multi-usuario: BER del enlace entre dos laptops (Lenovo T420 y Lenovo X60), una de ellas simulando varios nodos}
\label{fig:acumult}
\end{figure}


% De JIS2014MathType.pdf
%All measurements were conducted at a rate of 1000 bps, with the carrier signal at 16 kHz. The total data trans-
%mitted was 4096 bits. Output volume was set at the maximum possible for each device, while the input amplifi-
%cation was optimized for each measurement.
%We measured that the system operates with acceptable error rates for links of up to 1 meter, a distance usually
%exceeding that between a mobile terminal (phone, etc.) and a fixed computer placed in the same desk (see Fig-
%ure 7). Even for a high number of concurrent clients (>10) the system does not present high error rates or re-
%duced bandwidth, as can be seen in Figure 6.
%Although in the present test channel delay was longer than 60 seconds, excessive for some applications re-
%quiring short response time (e.g. banking transactions), this parameter can be reduced by decreasing the maxi-
%mum number of simultaneous users supported by the system and using a lower-delay interleaver and an outer
%error correction algorithm like BCH
%

\subsection{Medición a distinta separación}

\begin{figure}[t]
  \centering
    \includegraphics[width=4in]{graphs/mediciones-distancia-fig7.pdf}
\caption {Distancia: Enlace entre una Laptop (Lenovo T420) y un celular (HTC Status) presenta errores detectables solo cuando se supera 60 cm de separación.}
\label{fig:acudist}
\end{figure}

Las comunicaciónes acústicas utilizando como portadora un tono de 12 kHz son muy suceptibles al ruido ambiente. Un enlace acústico con 50 cm de separación entre un Laptop Lenovo T420 y un celular HTC Status sufrió mas de un $15\%$ de BER con solo una ligera interferencia (como por ejemplo golpear una mesa cercana). Esta observación motivo el uso de la frecuencia mas alto posible. Una portadora de 16 kHz presentó el mayor rango de compatibilidad entre los dispositivos testeados, algunos de ellos demostraron no poder emitir audio a frecuencias mayores.
Independientemente, algunas mediciones fueron realizadas a mayor frecuencia en dispositivos que lo soportaron. Por ejemplo, los parlantes de una Laptop T420 y otra Laptop Lenovo X60 fueron capaces de establecer un enlace utilizando como portadora un tono a 19.2 kHz, aunque solo en cortas distancias (20 cm). De todas formas, esta frecuencia de portadora permitió mayor ancho de banda en el enlace (2000 bps en lugar de 1000 bps) con la misma tasa de error.
La señal acústica modulada puede causar molestias a personas o animales cercanos. Distintos tonos de portadora causan distintos efectos y niveles de molestia, aunque este último parámetro es subjetivo. La portadora de 19.2 kHz fue descrita como no audible, mientras que la portadora a 16 kHz y 12 kHz son claramente audibles. Se notó que el volumen del sonido modulado y las molestias asociadas al mismo aumentan con el numero de clientes simultaneos transmitiendo en el medio.

% De JIS2014MathType.pdf
%Communications using a 12 kHz tone carrier were extremely susceptible to ambient noise. Indeed, a 50 cm
%link between a laptop Lenovo T420 and a HTC Status phone suffered an excess of 15% BER with slight noise
%%interference (like bumping on a nearby table). This observation motivated the use of the highest attainable fre-
%quency. A 16 kHz carrier provided the widest range of compatibility among tested devices, because some of
%them could not emit at higher frequencies.
%Tests were also done at higher frequencies for capable devices. For instance, laptop speakers in Lenovo T420
%and Lenovo X60 laptops proved capable of establishing a link at 19.2 kHz, but only for very short distances
%(20cm). Nevertheless, this carrier frequency allowed a faster link (2000 bps) with the same BER.
%The modulated sound signal can represent a nuisance to nearby persons and animals. Several different carrier
%frequencies were tested as a way to evaluate the level of discomfort. The 19.2 kHz carrier signal was perceived
%as almost non-audible, with 16 kHz being clearly audible for most people and the link at 12 kHz being the most
%uncomfortable. It should be noticed that loudness and hence discomfort increase with the number of simultane-
%hous users.
%

\section{Conclusiones}
